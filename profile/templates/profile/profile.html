{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">  
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <p class="small breadcrumbs">
                <strong>You Are Here:</strong> 
                <a href="{% url 'home' %}">HOME</a> <i class="fas fa-chevron-circle-right"></i> 
                <a href="{% url 'ProfileView' %}">PROFILE</a>
            </p>
            <div class="col-12 text-center">
                <h1 class="logo-font display-3 text-muted">
                    {{user}}'s Profile
                </h1>
                {% if user.profile.user_type == 1 %}
                    <h2><span class="text-muted logo-font">Account Type:</span> <u>Member</u></h2>
                    <p class="text-muted">Change To <a href="">Freelancer?</a></p>
                {% else %}
                    <h2><span class="text-muted logo-font">Account Type:</span> <u>Freelancer</u></h2>
                    <p class="text-muted">Change To <a href="">Basic Member Account?</a></p>
                {% endif %}
                <p class="h4"></p>
                <hr class="hr-center">
            </div>
        </div>
    </div>

<div class="relative">
    <div id="carouselExampleControls" class="carousel slide w-100" data-ride="carousel">
        <div class="carousel-inner">
        <!-- If They Have A Profile-->
            {% if user.profile.user_type == 2 %}
            <div class="carousel-item active">
                <!--Analytics Section-->
                <div class="container mb-5">
                    <div class="row p-0 m-0">
                        <div class="col border-white p-3 text-center">
                            <h3 class="logo-font text-muted">Sales:</h3>
                            <hr class="hr-center">
                            <br>
                            <p class="lead">{{user.profile.sales}}</p>
                        </div>
                        <div class="col border-white p-3 text-center">
                            <h3 class="logo-font text-muted">Earnings:</h3>
                            <hr class="hr-center">
                            <br>
                            <p class="lead">€{{user.profile.earnings}}</p>
                        </div>
                        <div class="col border-white p-3 text-center">
                            <h3 class="logo-font text-muted">Rating:</h3>
                            <hr class="hr-center">
                            <br>
                            <p class="lead">{{user.profile.rating}}</p>
                        </div>
                        <div class="col border-white p-3 text-center">
                            <h3 class="logo-font text-muted">Rank:</h3>
                            <hr class="hr-center">
                            <br>
                            {% if user.profile.rank == 5 %}
                                <p class="lead">General</p>
                            {% elif user.profile.rank == 4 %}
                                <p class="lead">Sergeant</p>
                            {% elif user.profile.rank == 3 %}
                                <p class="lead">Officer</p>
                            {% elif user.profile.rank == 2 %}
                                <p class="lead">Recruit</p>
                            {% elif user.profile.rank == 1 %}
                                <p class="lead">Member</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <div class="carousel-item">
                <!--General Analytics-->
                <div class="container mb-5">
                        <div class="row p-0 m-0">
                            <div class="col border-white p-3 text-center">
                                <h3 class="logo-font text-muted">Inbox:</h3>
                                <hr class="hr-center">
                                <br>
                                <p class="lead">{{inboxcount}} {% if inboxcount > 1 %}messages{% else %}message{% endif %}</p>
                            </div>
                            <div class="col border-white p-3 text-center">
                                <h3 class="logo-font text-muted">Outbox:</h3>
                                <hr class="hr-center">
                                <br>
                                <p class="lead">{{outboxcount}} {% if outboxcount > 1 %}messages{% else %}message{% endif %}</p>
                            </div>
                            <div class="col border-white p-3 text-center">
                                <h3 class="logo-font text-muted">Purchases:</h3>
                                <hr class="hr-center">
                                <br>
                                <p class="lead">{{user.profile.orders}}</p>
                            </div>
                            <div class="col border-white p-3 text-center">
                                <h3 class="logo-font text-muted">Total spent:</h3>
                                <hr class="hr-center">
                                <br>
                                <p class="lead">€ {{user.profile.orders}}</p>
                            </div>
                        </div>
                    </div>
                </div>    
            </div>
        </div>
        {% if user.profile.user_type == 2 %}
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        {% endif %}
    </div>
</div>

    
    

    
    
    <div class="container">
        <div class="row">
            <div class="col-12 col-sm-12 offset-sm-0 col-md-4 offset-md-1 col-lg-3 offset-lg-0">
                <div class="profile-photo">
                    {% if user.profile.image %}
                        <img src="{{ user.profile.image.url }}" alt="{{user}}s photo">
                    {% else %}
                        <img src="{% static 'img/default_user.png' %}" alt="Default User Photo">
                    {% endif %}
                </div>
                <div class="w-100 mx-auto">
                    {% if user.profile.first_name %}
                    <p class="h6 text-center mt-3"><span class="text-muted">Name: </span><br>{{user.profile.first_name}}</p>
                    {% else %}
                    <p class="h6 text-center mt-3"><span class="text-muted">Username: </span><br>{{user}}</p>
                    {% endif %}
                    <p class="h6 text-center"><span class="text-muted">Member Since: </span><br>{{user.profile.member_since}}</p>
                    {% if user.profile.user_type == 1 %}
                        <p class="h6 text-center"><span class="text-muted">Account Type:</span><br>Member</p>
                    {% elif user.profile.user_type == 2 %}
                        <p class="h6 text-center"><span class="text-muted">Account Type:</span><br>Freelancer</p>
                    {% endif %}
                    <div class="row ms-3 me-3">
                        <button class="btn btn-success btn-sm mb-2" type="button" id="edit_my_profile">Edit Profile</button><br>
                        <button class="btn btn-success mt-1 btn-sm" type="button" id="expand-controls">More Controls<br>
                            <i class="fas fa-chevron-circle-down" id="down"></i>
                            <i class="fas fa-chevron-circle-up" id="up"></i>
                        </button>   
                        <div class="row g-0 mt-2" id="extra-controls">
                            <button class="btn btn-sm btn-primary mt-1 mb-1" id="show-messages">Messages</button>
                            <button class="btn btn-sm btn-primary mt-1 mb-1">One</button>
                            <button class="btn btn-sm btn-primary mt-1 mb-1">One</button>
                            <button class="btn btn-sm btn-primary mt-1 mb-1">One</button>
                            <button class="btn btn-sm btn-primary mt-1 mb-1">One</button>
                        </div> 
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-12 col-md-7 col-lg-9">
                <!--Inner Layer-->
                <div class="row" id="contain-details">
                    <div class="row border-white profile-control-card" id="profile-details">
                        <h2 class="text-muted">Dashboard:</h2>
                        <hr class="left-div">
                        <p class="lead">Welcome Back {% if user.profile.first_name %}{{ user.profile.first_name }}{% else %}{{ user }}{% endif %}</p>
                        <p>You currently have <span class="bg-success p-2">0</span> active projects, and <span class="bg-warning p-2">0</span> projects in your queue.</p>
                    </div>
                    <div class="row border-white profile-control-card" id="message-container">
                        <h1>Messages</h1>
                        <p>You currently have <span class="bg-success p-2">{{inboxcount}}</span> {% if inboxcount > 1 %}messages{% else %}message{% endif %} in your inbox.</p>
                        {% for x in inbox %}
                            <div class="container border-white">
                                <div class="row">
                                    <div class="col">
                                        <p><span class="text-muted">Sent From:</span>{{x.sender}}</p>
                                    </div>
                                    <div class="col text-end">
                                        <p><span class="text-muted">Sent On:</span>{{x.created}}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <p>{{x.body}}</p>
                                </div>
                                <div class="row">
                                    <div class="col-12 text-end">
                                        <a href="" class="btn btn-success btn-sm p-1">Reply</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        
                    </div>
                    <div class="row" id="contain-edit">
                        <div class="row border-white profile-control-card">
                            <h1>Edit Profile</h1>
                            <form method="POST" id="edit-profile-form">
                                {% csrf_token %}
                                {{form|crispy}}  
                                <button class="btn btn-success" type="submit" id="submitProfileEdit">Update</button>  
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

{% endblock %}
{% block postloadjs %}
    <script src="{% static 'js/profile.js' %}">
    </script>
    <script type="text/javascript">
        $('#submitProfileEdit').click(function(){
            $('#edit-profile-form').attr('action', "{% url 'ProfileView' %}");
        })
    </script>

{% endblock %}